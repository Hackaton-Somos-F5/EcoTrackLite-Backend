# HU-B02 · Servicio de cálculo de alertas

**Como** desarrollador backend  
**Quiero** tener un servicio reutilizable que calcule si algún tipo supera su umbral  
**Para que** tanto el endpoint `GET /alertas` como el proceso de guardado `POST /residuos` usen la misma lógica centralizada.

---

## Criterios de Aceptación

- **Modularidad:** El archivo `services/alertas.py` contiene la función `calcular_alertas(db)` independiente.
- **Configuración:** Los umbrales se leen desde variables de entorno (`.env`).
- **Salida estructurada:** Devuelve una lista de objetos: `[{ tipo, volumen_actual, umbral, mensaje }]`.
- **Estado vacío:** Si ningún tipo supera el umbral, devuelve una lista vacía `[]`.
-  **Pureza:** La función no tiene efectos secundarios (no inserta en DB), solo consulta y calcula.
- **Formato de respuesta esperado:**
  ```json
  [
    { 
      "tipo": "plastico", 
      "volumen_actual": 120.5, 
      "umbral": 100.0, 
      "mensaje": "Alerta: El tipo plastico ha superado el umbral permitido." 
    }
  ]

## Tareas:
| Código | Nombre |Estado |
|--------|--------|--------|
| **TK-002-01** | Crear services/alertas.py con función calcular_alertas(db: Session)|Hecho|
| **TK-002-02** | Leer umbrales desde .env con os.getenv| Hecho|
| **TK-002-03** | Calcular volumen acumulado por tipo con func.sum de SQLAlchemy| Hecho|
| **TK-002-04** | Comparar cada tipo con su umbral y construir lista de alertas|Hecho|
| **TK-002-05** | Añadir valores por defecto en .env: UMBRAL_PLASTICO=100, etc.|Hecho|

  